"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),n=e(t),r=e(require("prop-types")),i=require("slate-react"),o=require("slate"),s=e(require("lodash/noop")),a=e(require("lodash/debounce")),l=require("immutable"),c=e(require("fast-deep-equal")),u=require("@contentful/rich-text-types"),d=require("@contentful/contentful-slatejs-adapter"),p=require("@contentful/field-editor-reference"),f=e(require("lodash/fromPairs")),h=e(require("@productboard/slate-edit-list")),m=require("emotion"),y=require("@contentful/f36-components"),E=e(require("@contentful/f36-tokens")),g=e(require("is-hotkey")),v=require("@contentful/f36-icons"),b=e(require("lodash/camelCase")),S=e(require("lodash/flow")),T=e(require("lodash/find")),C=e(require("lodash/get")),k=require("detect-browser"),I=require("@contentful/field-editor-shared"),A=e(require("@wikifactory/slate-trailing-block")),L=require("@contentful/rich-text-plain-text-renderer"),x=e(require("slate-html-serializer")),N=e(require("slate-plain-serializer")),D=e(require("react-dom")),O=e(require("lodash/throttle")),w=e(require("lodash/flatten")),R=e(require("classnames")),B=e(require("lodash/uniqBy"));function P(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(r,i)}function K(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function s(e){P(o,r,i,s,a,"next",e)}function a(e){P(o,r,i,s,a,"throw",e)}s(void 0)}))}}function _(){return(_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function H(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||(i[n]=e[n]);return i}function q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t){return t||(t=e.slice(0)),e.raw=t,e}var U,F,G,Y=function(e){var t=_({types:[u.BLOCKS.OL_LIST,u.BLOCKS.UL_LIST],typeItem:u.BLOCKS.LIST_ITEM,typeDefault:u.BLOCKS.PARAGRAPH},e);return h(t)},z=function(e){return f(e.map((function(e){return[e,{isVoid:!0}]})))},W=Y(),V={document:{nodes:[{types:u.TOP_LEVEL_BLOCKS}]},blocks:_((U={},U[u.BLOCKS.PARAGRAPH]={nodes:[{types:Object.values(u.INLINES)},{objects:["text","inline"]}]},U[u.BLOCKS.HEADING_1]={nodes:[{types:Object.values(u.INLINES)},{objects:["text","inline"]}]},U[u.BLOCKS.HEADING_2]={nodes:[{types:Object.values(u.INLINES)},{objects:["text","inline"]}]},U[u.BLOCKS.HEADING_3]={nodes:[{types:Object.values(u.INLINES)},{objects:["text","inline"]}]},U[u.BLOCKS.HEADING_4]={nodes:[{types:Object.values(u.INLINES)},{objects:["text","inline"]}]},U[u.BLOCKS.HEADING_5]={nodes:[{types:Object.values(u.INLINES)},{objects:["text","inline"]}]},U[u.BLOCKS.HEADING_6]={nodes:[{types:Object.values(u.INLINES)},{objects:["text","inline"]}]},U),z(u.VOID_BLOCKS),W.schema.blocks,(F={},F[u.BLOCKS.QUOTE]={nodes:[{match:[u.CONTAINERS[u.BLOCKS.QUOTE].map((function(e){return{type:e}}))],min:1}],normalize:function(e,t){if("child_type_invalid"===t.code)return e.unwrapBlockByKey(t.node.key,u.BLOCKS.QUOTE)}},F)),inlines:(G={},G[u.INLINES.HYPERLINK]={nodes:[{objects:["text"]}]},G[u.INLINES.ENTRY_HYPERLINK]={nodes:[{objects:["text"]}]},G[u.INLINES.ASSET_HYPERLINK]={nodes:[{objects:["text"]}]},G[u.INLINES.EMBEDDED_ENTRY]={isVoid:!0},G)},Q=function(e,t){return function(n,r){e(n,_({origin:t},r))}},X=function(e){var t=e.onAction;return{sdk:e.sdk,logViewportAction:Q(t,"viewport-interaction"),logShortcutAction:Q(t,"shortcut"),logToolbarAction:Q(t,"toolbar-icon"),logCommandPaletteAction:Q(t,"command-palette")}},J=_({},{richTextAPI:r.shape({sdk:r.object.isRequired,logViewportAction:r.func.isRequired,logShortcutAction:r.func.isRequired,logToolbarAction:r.func.isRequired})},{editor:r.object.isRequired,onToggle:r.func.isRequired,disabled:r.bool.isRequired,isButton:r.bool,canAutoFocus:r.bool}),$={button:m.css({height:"30px",width:"30px",marginLeft:E.spacing2Xs,marginRight:E.spacing2Xs}),tooltip:m.css({zIndex:Number(E.zIndexTooltip)})},Z=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).handleClick=function(e){e.preventDefault(),t.props.onToggle(e)},t}return H(t,e),t.prototype.render=function(){var e=this.props,t=e.title,r=e.type,i=e.isActive,o=e.children,s=e.disabled,a=void 0!==s&&s,l=n.createElement(y.Button,{className:m.cx($.button,e.className),isDisabled:a,startIcon:o,onClick:this.handleClick,testId:"toolbar-toggle-"+r,variant:i?"secondary":"transparent",size:"small"});return t?n.createElement(y.Tooltip,{className:$.tooltip,placement:"top",content:t},l):l},t}(t.Component);Z.propTypes={isActive:r.bool.isRequired,disabled:r.bool.isRequired,onToggle:r.func.isRequired,children:r.any.isRequired,title:r.string.isRequired,type:r.string,className:r.string};var ee={attributes:r.object.isRequired,children:r.node.isRequired,mark:r.string.isRequired},te={attributes:r.object.isRequired,children:r.node.isRequired,node:r.shape({type:r.string.isRequired}).isRequired},ne=function(e,t){return e.value.activeMarks.some((function(e){return e.type===t}))},re=function(e,t){return e.value.blocks.some((function(e){return e.type===t}))},ie=function(e,t){return e.value.inlines.some((function(e){return e.type===t}))},oe=function(e){var t=e.value;if(t.blocks.size>0)return t.blocks.some((function(e){return e.text}))},se={bold:m.css({color:"inherit",fontWeight:E.fontWeightDemiBold}),italic:m.css({fontStyle:"italic",lineHeight:1}),code:m.css({fontFamily:E.fontStackMonospace,fontSize:".9em"})};function ae(e){var t=e.type,r=e.tagName,i=e.hotkey,o=e.richTextAPI;return{renderMark:function(e,i,o){return e.mark.type===t?function(e,t){void 0===t&&(t={});var r=function(r){var i=r.children;return n.createElement(e,Object.assign({},t,r.attributes),i)};return r.displayName=e+"-mark",r.propTypes=ee,r}(r,{className:se[t]})(e):o()},onKeyDown:function(e,n,r){if(!g(i,e))return r();n.toggleMark(t);var s=ne(n,t)?"mark":"unmark";o.logShortcutAction(s,{markType:t})}}}var le=function(e,t){return function(n){n.preventDefault();var r=e.props,i=r.editor;if(!i.value.selection.isFocused){if(!r.canAutoFocus)return;i.focus()}return t(n)}},ce=function(e){var n=e.type,r=e.title,i=e.children;return function(e){var o,s;return s=o=function(o){function s(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=o.call.apply(o,[this].concat(r))||this).handleToggle=le(q(e),(function(){var t=e.props,r=t.editor,i=t.richTextAPI.logToolbarAction;(0,t.onToggle)(r.toggleMark(n)),i(ne(r,n)?"mark":"unmark",{markType:n})})),e}return H(s,o),s.prototype.render=function(){var o=this.props,s=o.disabled;return t.createElement(e,{type:n,title:r,onToggle:this.handleToggle,isActive:ne(o.editor,n),disabled:s},i)},s}(t.Component),o.propTypes=J,s}},ue=function(e){function t(){return e.apply(this,arguments)||this}return H(t,e),t.prototype.render=function(){return n.createElement(Z,this.props)},t}(t.Component),de=ce({type:u.MARKS.BOLD,title:"Bold",children:n.createElement(v.FormatBoldIcon,null)})(ue),pe=function(e){return ae({type:u.MARKS.ITALIC,tagName:"em",hotkey:["mod+i"],richTextAPI:e.richTextAPI})},fe=function(e){function t(){return e.apply(this,arguments)||this}return H(t,e),t.prototype.render=function(){return n.createElement(Z,this.props)},t}(t.Component),he=ce({type:u.MARKS.ITALIC,title:"Italic",children:n.createElement(v.FormatItalicIcon,null)})(fe),me=function(e){return ae({type:u.MARKS.UNDERLINE,tagName:"u",hotkey:["mod+u"],richTextAPI:e.richTextAPI})},ye=function(e){function t(){return e.apply(this,arguments)||this}return H(t,e),t.prototype.render=function(){return n.createElement(Z,this.props)},t}(t.Component),Ee=ce({type:u.MARKS.UNDERLINE,title:"Underline",children:n.createElement(v.FormatUnderlinedIcon,null)})(ye),ge=function(e){return ae({type:u.MARKS.CODE,tagName:"code",hotkey:["mod+/"],richTextAPI:e.richTextAPI})},ve=function(e){function t(){return e.apply(this,arguments)||this}return H(t,e),t.prototype.render=function(){return n.createElement(Z,this.props)},t}(t.Component),be=ce({type:u.MARKS.CODE,title:"Code",children:n.createElement(v.CodeIcon,null)})(ve),Se=function(e,t){var n=re(e,t);return e.setBlocks(n?u.BLOCKS.PARAGRAPH:t),!n},Te=function(e,t){return re(e,t)},Ce=function(e){var n=e.type,r=e.title,i=e.children,o=e.applyChange,s=void 0===o?Se:o,a=e.isActive,l=void 0===a?Te:a;return function(e){var o,a;return a=o=function(o){function a(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=o.call.apply(o,[this].concat(r))||this).handleToggle=le(q(e),(function(){var t=e.props,r=t.editor,i=t.onToggle,o=t.richTextAPI.logToolbarAction,a=s(r,n);i(r),o(a?"insert":"remove",{nodeType:n})})),e}return H(a,o),a.prototype.render=function(){var o=this.props,s=o.disabled,a=o.richTextAPI;return t.createElement(e,{type:n,title:r,onToggle:this.handleToggle,isActive:l(o.editor,n),disabled:s,richTextAPI:a},i)},a}(t.Component),o.propTypes=J,a}},ke=function(e){var t=function(e){var t=e.value.selection;if(!t.start.key)return null;var n=e.value.document.getClosestBlock(t.start.key);return e.value.document.getParent(n.key)}(e);return!!t&&t.type===u.BLOCKS.QUOTE},Ie=function(e){var t=ke(e);return t?e.unwrapBlock(u.BLOCKS.QUOTE):e.setBlocks(u.BLOCKS.PARAGRAPH).wrapBlock(u.BLOCKS.QUOTE),!t},Ae={fontWeight:E.fontWeightMedium,lineHeight:"1.3",margin:"0 0 "+E.spacingS},Le={paragraph:m.css({lineHeight:E.lineHeightDefault,marginBottom:"1.5em"}),bold:m.css({color:"inherit",fontWeight:E.fontWeightDemiBold}),blockquote:m.css({margin:"0 0 1.3125rem",borderLeft:"6px solid "+E.gray200,paddingLeft:"0.875rem",fontStyle:"normal","& a":{color:"inherit"}}),code:m.css({background:E.gray200,padding:"0px",color:E.gray700,borderRadius:E.borderRadiusSmall}),textLink:m.css({fontSize:"inherit"}),orderedList:m.css({margin:"0 0 1.25rem 1.25rem",listStyleType:"decimal",'[data-test-id="ordered-list"]':{listStyleType:"upper-alpha",'[data-test-id="ordered-list"]':{listStyleType:"lower-roman",'[data-test-id="ordered-list"]':{listStyleType:"lower-alpha"}}},'[data-test-id="paragraph"]':{margin:0,lineHeight:E.lineHeightDefault}}),unorderedList:m.css({margin:"0 0 1.25rem 1.25rem",listStyleType:"disc",'[data-test-id="unordered-list"]':{listStyleType:"circle",'[data-test-id="unordered-list"]':{listStyleType:"square"}},'[data-test-id="paragraph"]':{margin:0,lineHeight:E.lineHeightDefault}}),listItem:m.css({listStyle:"inherit",margin:0,'[data-test-id="ordered-list"], [data-test-id="unordered-list"]':{margin:"0 0 0 "+E.spacingL}}),heading1:m.css(_({},Ae,{fontSize:"1.875rem"})),heading2:m.css(_({},Ae,{fontSize:"1.5625rem"})),heading3:m.css(_({},Ae,{fontSize:"1.375rem"})),heading4:m.css(_({},Ae,{fontSize:"1.25rem"})),heading5:m.css(_({},Ae,{fontSize:"1.125rem"})),heading6:m.css(_({},Ae,{fontSize:"1rem"}))};function xe(e,n){void 0===n&&(n={});var r=function(r){var i=r.attributes,o=r.children,s=r.node;return t.createElement(e,Object.assign({className:Le[b(s.type)],"data-test-id":s.type},n,i),o)};return r.displayName=e+"-node",r.propTypes=te,r}var Ne=function(e,t,n){return function(t){var r=t.type,i=void 0===r?e:r,o=t.richTextAPI.logShortcutAction;return{renderNode:function(e,t,n){return e.node.type===i?xe("blockquote")(e):n()},onKeyDown:function(e,t,r){if(g(n,e)){var s=Ie(t);o(s?"insert":"remove",{nodeType:i})}else{if(!g("Backspace",e)||!ke(t)||oe(t))return r();t.unwrapBlock(u.BLOCKS.QUOTE).delete()}}}}}(u.BLOCKS.QUOTE,0,["mod+shift+1"]),De=function(e){function t(){return e.apply(this,arguments)||this}return H(t,e),t.prototype.render=function(){return n.createElement(Z,this.props)},t}(t.Component),Oe=Ce({type:u.BLOCKS.QUOTE,title:"Blockquote",children:n.createElement(v.QuoteIcon,null),applyChange:Ie,isActive:ke})(De);function we(e,t){return e(t={exports:{}},t.exports),t.exports}var Re=we((function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function a(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(e){a=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=Object.create((t&&t.prototype instanceof d?t:d).prototype),o=new C(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return{value:void 0,done:!0}}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=b(s,n);if(a){if(a===u)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=c(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===u)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(e,n,o),i}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var u={};function d(){}function p(){}function f(){}var h={};h[i]=function(){return this};var m=Object.getPrototypeOf,y=m&&m(m(k([])));y&&y!==t&&n.call(y,i)&&(h=y);var E=f.prototype=d.prototype=Object.create(h);function g(e){["next","throw","return"].forEach((function(t){a(e,t,(function(e){return this._invoke(t,e)}))}))}function v(e,t){var r;this._invoke=function(i,o){function s(){return new t((function(r,s){!function r(i,o,s,a){var l=c(e[i],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,s,a)}),(function(e){r("throw",e,s,a)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,a)}))}a(l.arg)}(i,o,r,s)}))}return r=r?r.then(s,s):s()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=c(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function k(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:I}}function I(){return{value:void 0,done:!0}}return p.prototype=E.constructor=f,f.constructor=p,p.displayName=a(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,a(e,s,"GeneratorFunction")),e.prototype=Object.create(E),e},e.awrap=function(e){return{__await:e}},g(v.prototype),v.prototype[o]=function(){return this},e.AsyncIterator=v,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var s=new v(l(t,n,r,i),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},g(E),a(E,s,"Generator"),E[i]=function(){return this},E.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=k,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var a=n.call(o,"catchLoc"),l=n.call(o,"finallyLoc");if(a&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,u):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:k(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));function Be(e){var n=p.useEntities(),r=n.getOrLoadEntry,i=n.loadEntityScheduledActions,o=n.entries;t.useEffect((function(){r(e.entryId)}),[e.entryId]);var s=o[e.entryId];if(t.useEffect((function(){s&&e.onEntityFetchComplete&&e.onEntityFetchComplete()}),[s]),"failed"===s)return t.createElement(p.MissingEntityCard,{entityType:"Entry",isDisabled:e.isDisabled,onRemove:e.onRemove});if(void 0===s)return t.createElement(y.EntryCard,{isLoading:!0});var a=e.sdk.space.getCachedContentTypes().find((function(e){return e.sys.id===s.sys.contentType.sys.id}));return t.createElement(p.WrappedEntryCard,{getAsset:e.sdk.space.getAsset,getEntityScheduledActions:i,entryUrl:e.getEntryUrl&&e.getEntryUrl(s.sys.id),isSelected:e.isSelected,isDisabled:e.isDisabled,localeCode:e.locale,defaultLocaleCode:e.sdk.locales.default,contentType:a,entry:s,onEdit:e.onEdit,onRemove:e.onRemove,isClickable:!1})}function Pe(e){var n=p.useEntities(),r=n.getOrLoadAsset,i=n.loadEntityScheduledActions,o=n.assets;t.useEffect((function(){r(e.assetId)}),[e.assetId]);var s=o[e.assetId];return t.useEffect((function(){s&&e.onEntityFetchComplete&&e.onEntityFetchComplete()}),[s]),"failed"===s?t.createElement(p.MissingEntityCard,{entityType:"Asset",isDisabled:e.isDisabled,onRemove:e.onRemove}):void 0===s?t.createElement(y.AssetCard,{size:"default",isLoading:!0,title:"",src:"",href:""}):t.createElement(p.WrappedAssetCard,{getAsset:e.sdk.space.getAsset,getEntityScheduledActions:i,getAssetUrl:e.getAssetUrl,size:"default",isSelected:e.isSelected,isDisabled:e.isDisabled,localeCode:e.locale,defaultLocaleCode:e.sdk.locales.default,asset:s,onEdit:e.onEdit,onRemove:e.onRemove,isClickable:!1})}function Ke(e){var t=e.sys;return{sys:{id:t.id,type:"Link",linkType:t.type}}}Be.propTypes={sdk:r.object.isRequired,entryId:r.string.isRequired,locale:r.string.isRequired,isDisabled:r.bool.isRequired,isSelected:r.bool.isRequired,onRemove:r.func,onEdit:r.func,getEntryUrl:r.func,onEntityFetchComplete:r.func},Pe.propTypes={sdk:r.object.isRequired,locale:r.string.isRequired,assetId:r.string.isRequired,isDisabled:r.bool.isRequired,isSelected:r.bool.isRequired,onRemove:r.func,onEdit:r.func,getAssetUrl:r.func,onEntityFetchComplete:r.func};var _e=function(e){function t(t){var n,r;(r=e.call(this,t)||this).handleSubmit=function(e){e.preventDefault(),r.props.onClose(r.getValue())},r.selectEntry=K(Re.mark((function e(){var t,n,i;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(t=r.props.entitySelectorConfigs.Entry).locale,i=t.contentTypes,e.next=3,r.props.sdk.dialogs.selectSingleEntry({locale:n,contentTypes:i});case 3:r.setTargetEntity("Entry",e.sent);case 5:case"end":return e.stop()}}),e)}))),r.selectAsset=K(Re.mark((function e(){var t;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.props.entitySelectorConfigs.Asset.locale,e.next=3,r.props.sdk.dialogs.selectSingleAsset({locale:t});case 3:r.setTargetEntity("Asset",e.sent);case 5:case"end":return e.stop()}}),e)})));var i=t.value,o=i.text,s=i.type,a=i.uri,l=i.target,c=Boolean(l),u=((n={}).Entry=null,n.Asset=null,n),d=s;return c?u[d=l.sys.linkType]=l:d=t.allowedHyperlinkTypes.includes("uri")?"uri":t.allowedHyperlinkTypes[0],r.state={text:o,uri:a,entityLinks:u,type:d},r}H(t,e);var r=t.prototype;return r.setTargetEntity=function(e,t){this.setState((function(n){var r;return{entityLinks:_({},n.entityLinks,(r={},r[e]=t?Ke(t):void 0,r))}}))},r.getValue=function(){var e=this.state,t=e.text,n=e.type,r=e.uri,i={type:n};return t&&(i.text=t),"uri"===n?i.uri=r:i.target=this.state.entityLinks[n],i},r.isLinkComplete=function(){var e=this.getValue();return!(!this.props.hideText&&!e.text)&&("uri"===e.type&&e.uri||e.target)},r.render=function(){var e=this,t=this.props.labels;return n.createElement(p.EntityProvider,{sdk:this.props.sdk},n.createElement(n.Fragment,null,n.createElement(y.ModalContent,null,this.renderFields()),n.createElement(y.ModalControls,null,n.createElement(y.Button,{type:"button",onClick:function(){return e.props.onClose(null)},variant:"secondary",testId:"cancel-cta",size:"small"},"Cancel"),n.createElement(y.Button,{type:"submit",variant:"positive",onClick:this.handleSubmit,isDisabled:!this.isLinkComplete(),testId:"confirm-cta",size:"small"},t.confirm))))},r.renderFields=function(){var e=this,t=this.props,r=t.hideText,i=t.allowedHyperlinkTypes,o=t.entitySelectorConfigs,s=this.state,a=s.uri,l=s.text,c=s.type,u="uri"===c&&(r||!!l);return n.createElement(y.Form,null,r?null:n.createElement(y.FormControl,{id:"link-text",isRequired:!0},n.createElement(y.FormControl.Label,null,"Link text"),n.createElement(y.TextInput,{testId:"link-text-input",name:"link-text",value:l||"",onChange:function(t){return e.setState({text:t.target.value})},autoFocus:!u})),function(e){return void 0===e&&(e={}),!!e.Entry||!!e.Asset}(o)&&n.createElement(y.FormControl,{id:"link-type",name:"link-type"},n.createElement(y.FormControl.Label,null,"Link type"),n.createElement(y.Select,{value:c,onChange:function(t){return e.setState({type:t.target.value})},testId:"link-type-select"},i.includes("uri")||"uri"===c?n.createElement(y.Select.Option,{value:"uri"},"URL"):null,i.includes("Entry")||"Entry"===c?n.createElement(y.Select.Option,{value:"Entry"},"Entry"):null,i.includes("Asset")||"Asset"===c?n.createElement(y.Select.Option,{value:"Asset"},"Asset"):null)),"uri"===c?n.createElement(y.FormControl,{id:"link-uri",isRequired:!0},n.createElement(y.FormControl.Label,null,"Link target"),n.createElement(y.TextInput,{testId:"link-uri-input",name:"link-uri",value:a||"",placeholder:"https://",onChange:function(t){return e.setState({uri:t.target.value})},autoFocus:u}),n.createElement(y.FormControl.HelpText,null,"A protocol may be required, e.g. https://")):this.renderEntityField())},r.renderEntityField=function(){var e=this,t=this.state,r=t.type,i=t.entityLinks[r],o=!i;return n.createElement("div",null,n.createElement(y.FormLabel,{required:!0,htmlFor:""},"Link target"),!o&&n.createElement(y.TextLink,{as:"button",className:m.css({marginLeft:E.spacingS}),onClick:function(){return e.setTargetEntity(r,null)}},"Remove selection"),i&&n.createElement("div",null,"Entry"===r&&n.createElement(Be,{sdk:this.props.sdk,locale:this.props.entitySelectorConfigs.Entry.locale,entryId:i.sys.id,isDisabled:!0,isSelected:!1}),"Asset"==r&&n.createElement(Pe,{sdk:this.props.sdk,locale:this.props.entitySelectorConfigs.Asset.locale,assetId:i.sys.id,isDisabled:!0,isSelected:!1})),o&&this.renderEntitySelector(r,o))},r.renderEntitySelector=function(e){return n.createElement("div",{className:m.css({marginTop:E.spacingS})},"Entry"===e&&n.createElement(y.TextLink,{as:"button",onClick:this.selectEntry},"Select entry"),"Asset"===e&&n.createElement(y.TextLink,{as:"button",onClick:this.selectAsset},"Select asset"))},t}(n.Component);_e.propTypes={sdk:r.object.isRequired,labels:r.shape({title:r.string,confirm:r.string}),value:r.shape({text:r.string,uri:r.string,target:r.object,type:r.oneOf(["uri","Entry","Asset"])}),entitySelectorConfigs:r.object,allowedHyperlinkTypes:r.arrayOf(r.oneOf(["Entry","Asset","uri"])),hideText:r.bool,onClose:r.func.isRequired},_e.defaultProps={labels:{title:"Insert link",confirm:"Insert link"},value:{},hideText:!1,entitySelectorConfigs:{},allowedHyperlinkTypes:["Entry","Asset","uri"]};var He=function(e,t){var n=t.value,r=!(n.uri||n.target),i={labels:{title:r?"Insert hyperlink":"Edit hyperlink",confirm:r?"Insert":"Update"},value:n,hideText:!t.showTextInput,allowedHyperlinkTypes:t.allowedHyperlinkTypes,entitySelectorConfigs:t.entitySelectorConfigs};return e.openCurrent({title:i.labels.title,width:"large",shouldCloseOnEscapePress:!0,shouldCloseOnOverlayClick:!0,allowHeightOverflow:!0,parameters:_({type:"rich-text-hyperlink-dialog"},i)})},Me=function(e,t){return S((function(e){return T(e,"nodes")}),(function(e){return C(e,["nodes",t])}),(function(e){return T(e,"linkContentType")}),(function(e){return C(e,"linkContentType",[])}))(e.validations)};function qe(e,t){return{entityType:je(t),locale:e.locale||null,contentTypes:Me(e,t)}}function je(e){var t=e.split("-");if(-1!==t.indexOf("entry"))return"Entry";if(-1!==t.indexOf("asset"))return"Asset";throw new Error("RichText node type `"+e+"` has no associated `entityType`")}var Ue,Fe=function(e,t,n){var r=function(e,t){return S((function(e){return T(e,t)}),(function(e){return C(e,t)}))(e.validations)}(e,t);return void 0===r||r.includes(n)},Ge=function(e,t){return Fe(e,"enabledNodeTypes",t)},Ye=function(e,t){return Fe(e,"enabledMarks",t)},ze=u.INLINES.HYPERLINK,We=u.INLINES.ENTRY_HYPERLINK,Ve=u.INLINES.ASSET_HYPERLINK,Qe=[ze,We,Ve],Xe=((Ue={})[u.INLINES.ENTRY_HYPERLINK]="Entry",Ue[u.INLINES.ASSET_HYPERLINK]="Asset",Ue[u.INLINES.HYPERLINK]="uri",Ue);function Je(e){var t=[u.INLINES.ENTRY_HYPERLINK,u.INLINES.ASSET_HYPERLINK,u.INLINES.HYPERLINK];return"RichText"===e.type?t.filter((function(t){return Ge(e,t)})).map((function(e){return Xe[e]})):t.map((function(e){return Xe[e]}))}function $e(e){var t={};return Ge(e,u.INLINES.ENTRY_HYPERLINK)&&(t.Entry=qe(e,"entry-hyperlink")),Ge(e,u.INLINES.ASSET_HYPERLINK)&&(t.Asset=qe(e,"asset-hyperlink")),t}function Ze(e){return!e.isExpanded&&et(e)}function et(e){return Qe.some((function(t){return ie({value:e},t)}))}function tt(e){return e.inlines.every((function(e){return Qe.includes(e.type)}))}function nt(e,t,n){return rt.apply(this,arguments)}function rt(){return(rt=K(Re.mark((function e(t,n,r){return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!et(t.value)){e.next=4;break}st(t,r),e.next=6;break;case 4:return e.next=6,it(t,n,r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function it(e,t,n){return ot.apply(this,arguments)}function ot(){return(ot=K(Re.mark((function e(t,n,r){var i,o,s,a,l,c,d;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.blur(),r("openCreateHyperlinkDialog"),i=!t.value.isExpanded||""===t.value.fragment.text.trim(),e.next=5,He(n.dialogs,{showTextInput:i,value:{text:t.value.fragment.text||""},allowedHyperlinkTypes:Je(n.field),entitySelectorConfigs:$e(n.field)});case 5:if(o=e.sent){e.next=10;break}return r("cancelCreateHyperlinkDialog"),t.focus(),e.abrupt("return");case 10:s=o.text,a=o.type,l=o.uri,c=o.target,i&&(t.isVoid(t.value.blocks.last())&&t.insertBlock(u.BLOCKS.PARAGRAPH),t.insertText(s).moveFocusForward(0-s.length)),t.call(ct,a,c?{target:c}:{uri:l}),d=ut(a),r("insert",{nodeType:d,linkType:a}),t.focus();case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function st(e,t){Qe.forEach((function(t){return e.unwrapInline(t)})),e.focus(),t("unlinkHyperlinks")}function at(e,t,n){return lt.apply(this,arguments)}function lt(){return(lt=K(Re.mark((function e(t,n,r){var i,o,s,a,l,c,u,d,p;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.value.inlines.get(0)){e.next=3;break}throw new Error("Change object contains no link to be edited.");case 3:return t.blur(),r("openEditHyperlinkDialog"),o=i.data.toJSON(),s=o.uri,a=o.target,e.next=8,He(n.dialogs,{showTextInput:!1,value:a?{target:a}:{uri:s},allowedHyperlinkTypes:Je(n.field),entitySelectorConfigs:$e(n.field)});case 8:if(l=e.sent){e.next=13;break}return r("cancelEditHyperlinkDialog"),t.focus(),e.abrupt("return");case 13:u=l.uri,d=l.target,p=ut(c=l.type),t.setInlines({type:p,data:d?{target:d}:{uri:u}}),r("edit",{nodeType:p,linkType:c}),t.focus();case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ct(e,t,n){e.wrapInline({type:ut(t),data:n}),e.moveToEnd()}function ut(e){switch(e){case"Entry":return We;case"Asset":return Ve}return ze}var dt=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).handleClick=le(q(t),K(Re.mark((function e(){var n,r,i,o,s,a;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=t.props).onToggle,i=n.editor,s=(o=n.richTextAPI).sdk,a=o.logToolbarAction,e.next=3,nt(i,s,a);case 3:r(i);case 4:case"end":return e.stop()}}),e)})))),t}return H(t,e),t.prototype.render=function(){var e=this.props,t=e.editor,r=e.disabled||!tt(t.value);return n.createElement(Z,{disabled:r,type:u.INLINES.HYPERLINK,title:"Hyperlink",onToggle:this.handleClick,isActive:et(t.value)},n.createElement(v.LinkIcon,null))},t}(t.Component);dt.propTypes=J;var pt={hyperlinkWrapper:m.css({display:"inline",position:"static",a:{fontSize:"inherit !important"}}),hyperlink:m.css({fontSize:"inherit !important",display:"inline !important","&:hover":{fill:E.textColorDark},"&:focus":{fill:E.textColorDark}}),hyperlinkIEFallback:m.css({color:"#1683d0",textDecoration:"underline"}),hyperlinkIcon:m.css({position:"relative",top:"4px",height:"14px",margin:"0 -2px 0 -1px",webkitTransition:"fill 100ms ease-in-out",transition:"fill 100ms ease-in-out","&:hover":{fill:E.textColorDark},"&:focus":{fill:E.textColorDark}})},ft=k.detect(),ht=!(ft&&"ie"===ft.name);function mt(){return(mt=K(Re.mark((function e(t){var n,r,i,o,s,a,l,c,u,d,p,f,h;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.sdk,r=t.entityId,o=t.localeCode,s=t.defaultLocaleCode,l="Entry"===(i=t.entityType)?n.space.getEntry:n.space.getAsset,e.next=4,l(r);case 4:return(c=e.sent).sys.contentType&&(u=c.sys.contentType.sys.id,a=n.space.getCachedContentTypes().find((function(e){return e.sys.id===u}))),d="Entry"===i?I.entityHelpers.getEntryTitle({entry:c,contentType:a,localeCode:o,defaultLocaleCode:s,defaultTitle:"Untitled"}):I.entityHelpers.getAssetTitle({asset:c,localeCode:o,defaultLocaleCode:s,defaultTitle:"Untitled"}),p=I.entityHelpers.getEntityDescription({entity:c,contentType:a,localeCode:o,defaultLocaleCode:s}),e.next=10,n.space.getEntityScheduledActions(i,r);case 10:return f=e.sent,h=I.entityHelpers.getEntryStatus(c.sys),e.abrupt("return",{jobs:f,entity:c,entityTitle:d,entityDescription:p,entityStatus:h,contentTypeName:a?a.name:""});case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var yt=["jobs"];function Et(e){var t,r,i=e.children,o=e.node,s=o.data.get("title"),a=o.data.get("uri"),l=/^(?:[a-z]+:)?\/\//i.test(t=a)||/^mailto:/i.test(t)?a:"javascript:void(0)",c=o.data.get("target"),u=function(e){var t=e.target,r=e.richTextAPI.sdk,i=n.useState({type:"loading"}),o=i[0],s=i[1];return n.useEffect((function(){var e,n;t&&function(e){return mt.apply(this,arguments)}({sdk:r,entityId:null==t||null==(e=t.sys)?void 0:e.id,entityType:null==t||null==(n=t.sys)?void 0:n.linkType,localeCode:r.field.locale,defaultLocaleCode:r.locales.default}).then((function(e){s({type:"success",data:e})})).catch((function(e){console.log(e),s({type:"error",error:e})}))}),[t]),o}({richTextAPI:e.richTextAPI,target:c});return n.createElement("span",Object.assign({},e.attributes,{onClick:e.onEdit,onKeyDown:function(t){return function(t){g("enter",t)&&(t.preventDefault(),t.stopPropagation(),e.onEdit(t))}(t)},role:"button",tabIndex:0}),(r=c?{tooltipContent:function(){if("loading"===u.type)return"Loading "+c.sys.linkType.toLowerCase()+"...";var e,t,n,r="";if("error"===u.type)r=c.sys.linkType+" missing or inaccessible";else{var i=u.data,o=i.jobs;n=(e=M(i,yt)).entityStatus,r=(e.contentTypeName||"Asset")+' "'+(((t=e.entityTitle)&&t.length>60?t&&t.substr(0,61).replace(/(\s+\S(?=\S)|\s*)\.?.$/,"…"):t)||"Untitled")+'", '+n+"\n    "+(o.length>0?p.getScheduleTooltipContent({job:o[0],jobsCount:o.length}):"")}return r}()}:{tooltipContent:a},n.createElement(y.Tooltip,{content:r.tooltipContent,className:pt.tooltipContainer,targetWrapperClassName:pt.hyperlinkWrapper,placement:"bottom",maxWidth:"auto"},ht?n.createElement(y.TextLink,{href:l,rel:"noopener noreferrer",title:s,className:pt.hyperlink},i):n.createElement("span",{className:m.cx(pt.hyperlink,pt.hyperlinkIEFallback)},i))))}Et.propTypes={attributes:r.object.isRequired,node:r.object.isRequired,children:r.node,editor:r.object,richTextAPI:r.object.isRequired,onEdit:r.func};var gt=u.INLINES.HYPERLINK,vt=u.INLINES.ENTRY_HYPERLINK,bt=u.INLINES.ASSET_HYPERLINK,St=function(e){var t=e.richTextAPI;return{renderNode:function(e,r,i){var o=t.sdk,s=t.logViewportAction,a=e.node,l=e.editor;return Tt(a.type)?n.createElement(Et,Object.assign({},e,{richTextAPI:t,onEdit:function(e){e.preventDefault(),l.moveToRangeOfNode(a).focus(),Ze(l.value)&&at(l,o,s)}})):i()},onKeyDown:function(e,n,r){var i=t.sdk,o=t.logShortcutAction;if(!g(["mod+k"],e)||!tt(n.value))return r();Ze(n.value)?at(n,i,o):nt(n,i,o)},normalizeNode:function(e,t,n){if(Tt(e.type)){if(""===e.text.trim())return function(){t.removeNodeByKey(e.key)};if(e.getInlines().size>0)return function(){e.getInlines().forEach((function(n){return t.unwrapInlineByKey(n.key,e.type)}))}}n()}}};function Tt(e){return[gt,vt,bt].includes(e)}var Ct={root:m.css({fontWeight:E.fontWeightDemiBold,lineHeight:1.5}),h1:m.css({fontSize:"1.625rem"}),h2:m.css({fontSize:"1.4375rem"}),h3:m.css({fontSize:"1.25rem"}),h4:m.css({fontSize:"1.125rem"}),h5:m.css({fontSize:"1rem"}),h6:m.css({fontSize:"0.875rem"})},kt=function(e){return e.replace("heading-","h")},It=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).handleClick=function(e){e.preventDefault(),t.props.onToggle(e)},t}return H(t,e),t.prototype.render=function(){var e=this.props,t=e.type,r=e.children;return n.createElement(y.Menu.Item,{label:e.title,isInitiallyFocused:e.isActive,"data-test-id":"toolbar-toggle-"+t,className:m.cx(Ct.root,Ct[kt(t)]),onClick:this.handleClick},r)},t}(t.Component);It.propTypes={isActive:r.bool.isRequired,onToggle:r.func.isRequired,title:r.string.isRequired,type:r.string,children:r.node};var At,Lt,xt=function(e){var n=e.type,r=e.title,i=e.children,o=e.applyChange,s=void 0===o?function(e,t){return e.setBlocks(t)}:o;return function(e){var o,a;return a=o=function(o){function a(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=o.call.apply(o,[this].concat(r))||this).handleSelect=le(q(e),(function(){var t=e.props,r=t.editor,i=t.onToggle,o=t.richTextAPI.logToolbarAction;s(r,n),i(r),o("insert",{nodeType:n})})),e}return H(a,o),a.prototype.render=function(){var o=this.props,s=o.disabled;return t.createElement(e,{type:n,title:r,onToggle:this.handleSelect,isActive:re(o.editor,n),disabled:s},i)},a}(t.Component),o.propTypes=J,a}},Nt={root:m.css((At={padding:0,marginRight:E.spacing2Xs,width:"110px"},At["@media (min-width: "+E.contentWidthDefault+")"]={width:"145px"},At))},Dt=((Lt={})[u.BLOCKS.HEADING_1]="Heading 1",Lt[u.BLOCKS.HEADING_2]="Heading 2",Lt[u.BLOCKS.HEADING_3]="Heading 3",Lt[u.BLOCKS.HEADING_4]="Heading 4",Lt[u.BLOCKS.HEADING_5]="Heading 5",Lt[u.BLOCKS.HEADING_6]="Heading 6",Lt[u.BLOCKS.PARAGRAPH]="Normal Text",Lt[u.BLOCKS.EMBEDDED_ENTRY]="Embedded Entry",Lt[u.BLOCKS.EMBEDDED_ASSET]="Embedded Asset",Lt),Ot=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).getStyleNameForChange=function(){return Dt[t.props.currentBlockType]||Dt[u.BLOCKS.PARAGRAPH]},t}return H(t,e),t.prototype.render=function(){var e=this.props,t=e.children;return n.createElement(y.Menu,{isOpen:e.isOpen,onClose:e.onClose,onOpen:e.onOpen},n.createElement(y.Menu.Trigger,null,n.createElement(y.Button,{endIcon:n.createElement(v.ChevronDownIcon,null),"data-test-id":"toolbar-heading-toggle",className:Nt.root,variant:"transparent",size:"small",isDisabled:this.props.disabled},this.getStyleNameForChange())),n.createElement(y.Menu.List,{className:"toolbar-heading-dropdown-list"},t))},t}(t.Component);function wt(e){var r=Dt[e],i=function(t){function i(){return t.apply(this,arguments)||this}return H(i,t),i.prototype.render=function(){return n.createElement(It,Object.assign({},this.props,{"data-test-id":e}),r)},i}(t.Component);return i.displayName=r.replace(/\s/g,""),xt({type:e,title:r})(i)}Ot.propTypes={children:r.node.isRequired,isOpen:r.bool,disabled:r.bool,onClose:r.func,onOpen:r.func,currentBlockType:r.string};var Rt=function(e){function t(){return e.apply(this,arguments)||this}return H(t,e),t.prototype.render=function(){return n.createElement(It,this.props,Dt[u.BLOCKS.PARAGRAPH])},t}(t.Component),Bt=xt({type:u.BLOCKS.PARAGRAPH,title:Dt[u.BLOCKS.PARAGRAPH],shouldToggle:!1})(Rt),Pt=function(e,t,n){return function(r){var i=r.type,o=void 0===i?e:i,s=r.richTextAPI;return{renderNode:function(e,n,r){return e.node.type===o?xe(t,{})(e):r()},onKeyDown:function(e,t,r){if(g("enter",e)){if(t.value.blocks.get(0).type===o){var i=t.value;if(0===i.selection.start.offset){var a=i.selection;t.splitBlock().setBlocksAtRange(a,u.BLOCKS.PARAGRAPH)}else t.splitBlock().setBlocks(u.BLOCKS.PARAGRAPH);return}}else if(g(n,e)){var l=Se(t,o);return void s.logShortcutAction(l?"insert":"remove",{nodeType:o})}return r()}}}},Kt=Pt(u.BLOCKS.HEADING_1,"h1",["mod+opt+1"]),_t=Pt(u.BLOCKS.HEADING_2,"h2",["mod+opt+2"]),Ht=Pt(u.BLOCKS.HEADING_3,"h3",["mod+opt+3"]),Mt=Pt(u.BLOCKS.HEADING_4,"h4",["mod+opt+4"]),qt=Pt(u.BLOCKS.HEADING_5,"h5",["mod+opt+5"]),jt=Pt(u.BLOCKS.HEADING_6,"h6",["mod+opt+6"]),Ut=wt(u.BLOCKS.HEADING_1),Ft=wt(u.BLOCKS.HEADING_2),Gt=wt(u.BLOCKS.HEADING_3),Yt=wt(u.BLOCKS.HEADING_4),zt=wt(u.BLOCKS.HEADING_5),Wt=wt(u.BLOCKS.HEADING_6);function Vt(e,t,n,r){return Qt.apply(this,arguments)}function Qt(){return(Qt=K(Re.mark((function e(t,n,r,i){var o,s,a,l,c;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i("openCreateEmbedDialog",{nodeType:t}),o=n.dialogs,s=qe(n.field,t),a="Asset"===s.entityType?o.selectSingleAsset:o.selectSingleEntry,l=_({},s,{withCreate:!0}),e.prev=5,e.next=8,a(l);case 8:if(c=e.sent){e.next=11;break}return e.abrupt("return");case 11:Xt(r,t,c),i("insert",{nodeType:t}),e.next=22;break;case 15:if(e.prev=15,e.t0=e.catch(5),!e.t0){e.next=21;break}throw e.t0;case 21:i("cancelCreateEmbedDialog",{nodeType:t});case 22:case"end":return e.stop()}}),e,null,[[5,15]])})))).apply(this,arguments)}function Xt(e,t,n,r){void 0===r&&(r=!0);var i=function(e,t){return{type:e,object:"block",data:{target:{sys:{id:t.sys.id,type:"Link",linkType:t.sys.type}}}}}(t,n);0===e.value.blocks.size||oe(e)?e.insertBlock(i):e.setBlocks(i),r&&e.insertBlock(u.BLOCKS.PARAGRAPH).focus()}var Jt=m.css({marginRight:"10px"}),$t=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).handleClick=function(e){t.handleAction(e)},t.handleAction=le(q(t),K(Re.mark((function e(){var n,r,i,o,s,a;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=t.props).editor,i=n.nodeType,s=(o=n.richTextAPI).sdk,a=o.logToolbarAction,e.next=3,Vt(i,s,r,a);case 3:t.props.onToggle(r);case 4:case"end":return e.stop()}}),e)})))),t}return H(t,e),t.prototype.render=function(){var e=this.props.nodeType,t=function(e){var t=e.toLowerCase().split("-");if(t.includes("entry"))return"Entry";if(t.includes("asset"))return"Asset";throw new Error("Node type `"+e+"` has no associated `entityType`")}(e),r="rich-text__"+e;return this.props.isButton?n.createElement(y.Button,{isDisabled:this.props.disabled,className:r+"-button",size:"small",onClick:this.handleClick,startIcon:n.createElement("Asset"===t?v.AssetIcon:v.EmbeddedEntryBlockIcon,null),variant:"secondary",testId:"toolbar-toggle-"+e},"Embed "+t.toLowerCase()):n.createElement(y.Menu.Item,{disabled:this.props.disabled,className:r+"-list-item",onClick:this.handleClick,testId:"toolbar-toggle-"+e},n.createElement(y.Flex,{alignItems:"center",flexDirection:"row"},n.createElement(y.Icon,{as:"Asset"===t?v.AssetIcon:v.EmbeddedEntryBlockIcon,className:"rich-text__embedded-entry-list-icon "+Jt,variant:"secondary"}),n.createElement("span",null,t)))},t}(t.Component);$t.propTypes=_({},J,{isButton:r.bool}),$t.defaultProps={isButton:!1};var Zt={root:m.css({marginBottom:"1.25rem"})},en=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).handleEditClick=function(){var e=t.getEntitySys(),n=t.props.sdk.navigator;return("Asset"===e.type?n.openAsset:n.openEntry)(e.id,{slideIn:!0})},t.handleRemoveClick=function(){var e=t.props,n=e.editor,r=e.node;n.moveToRangeOfNode(r),n.removeNodeByKey(r.key),n.focus()},t}H(t,e);var r=t.prototype;return r.getEntitySys=function(){var e=this.props.node.data;return{id:e.get("target").sys.id,type:e.get("target").sys.linkType}},r.render=function(){var e=this.props,t=e.sdk,r=e.editor,i=e.isSelected,o=r.props.readOnly||r.props.actionsDisabled,s=this.getEntitySys(),a=s.id,l=s.type;return n.createElement("div",Object.assign({},this.props.attributes,{className:Zt.root}),"Entry"===l&&n.createElement(Be,{sdk:t,entryId:a,locale:t.field.locale,isDisabled:o,isSelected:i,onRemove:this.handleRemoveClick,onEdit:this.handleEditClick,getEntryUrl:function(){var e=t.parameters.instance.getEntryUrl;return"function"==typeof e?e(a):""},onEntityFetchComplete:this.props.onEntityFetchComplete}),"Asset"===l&&n.createElement(Pe,{sdk:t,assetId:a,locale:t.field.locale,isDisabled:o,isSelected:i,onRemove:this.handleRemoveClick,onEdit:this.handleEditClick,getAssetUrl:function(){var e=t.parameters.instance.getAssetUrl;return"function"==typeof e?e(a):""},onEntityFetchComplete:this.props.onEntityFetchComplete}))},t}(n.Component);en.propTypes={sdk:r.object.isRequired,isSelected:r.bool.isRequired,attributes:r.object.isRequired,editor:r.object.isRequired,node:r.object.isRequired,onEntityFetchComplete:r.func.isRequired};var tn=function(e){var t=e.richTextAPI,r=t.sdk,i=t.logShortcutAction,o=t.logViewportAction,s=e.nodeType,a=e.hotkey;return{renderNode:function(e,t,i){var a=e.key;return e.node.type===s?n.createElement(en,Object.assign({sdk:r},e,e.attributes,{onEntityFetchComplete:function(){o("linkRendered",{key:a})}})):i()},onKeyDown:function(e,t,n){if(a&&g(a,e))Vt(s,r,t,i);else{if(!g("enter",e)||!function(e,t){return e.value.blocks.get(0).type===t}(t,s))return n();t.insertBlock(u.BLOCKS.PARAGRAPH).focus()}}}},nn=function(e){return{type:u.INLINES.EMBEDDED_ENTRY,object:"inline",data:{target:{sys:{id:e,type:"Link",linkType:"Entry"}}}}},rn=function(e,t,n){void 0===n&&(n=!0),ie(e,u.INLINES.EMBEDDED_ENTRY)?e.setInlines(nn(t)):e.insertInline(nn(t)),n&&e.moveToStartOfNextText().focus()},on=function(){var e=K(Re.mark((function e(t,n,r){var i,o,s,a,l;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r("openCreateEmbedDialog",{nodeType:i=u.INLINES.EMBEDDED_ENTRY}),o=t.dialogs,s=qe(t.field,i),a=_({},s,{withCreate:!0}),e.prev=5,e.next=8,o.selectSingleEntry(a);case 8:if(l=e.sent){e.next=11;break}return e.abrupt("return");case 11:rn(n,l.sys.id),r("insert",{nodeType:i}),e.next=22;break;case 15:if(e.prev=15,e.t0=e.catch(5),!e.t0){e.next=21;break}throw e.t0;case 21:r("cancelCreateEmbedDialog",{nodeType:i});case 22:case"end":return e.stop()}}),e,null,[[5,15]])})));return function(t,n,r){return e.apply(this,arguments)}}(),sn=function(e){return!(e.value.inlines.size>0)||(t=u.INLINES.EMBEDDED_ENTRY,(n=e.value).inlines.size>0&&n.inlines.every((function(e){return e.type===t})));var t,n},an={icon:m.css({marginRight:"10px"}),root:m.css({margin:"0px 5px",fontSize:"inherit",span:{webkitUserSelect:"none",mozUserSelect:"none",msUserSelect:"none",userSelect:"none"}})},ln=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).handleClick=function(e){t.handleAction(e)},t.handleAction=le(q(t),K(Re.mark((function e(){var n,r,i,o,s;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=t.props).editor,o=(i=n.richTextAPI).sdk,s=i.logToolbarAction,e.next=3,on(o,r,s);case 3:t.props.onToggle(r);case 4:case"end":return e.stop()}}),e)})))),t}return H(t,e),t.prototype.render=function(){var e=this;return this.props.isButton?n.createElement(y.Button,{isDisabled:this.props.disabled,className:u.INLINES.EMBEDDED_ENTRY+"-button",size:"small",onClick:function(t){return e.handleClick(t)},startIcon:n.createElement(v.EmbeddedEntryInlineIcon,null),variant:"secondary",testId:"toolbar-toggle-"+u.INLINES.EMBEDDED_ENTRY},"Embed inline entry"):n.createElement(y.Menu.Item,{disabled:this.props.disabled||!sn(this.props.editor),className:"rich-text__entry-link-block-button",testId:"toolbar-toggle-"+u.INLINES.EMBEDDED_ENTRY,onClick:this.handleClick},n.createElement(y.Flex,{alignItems:"center",flexDirection:"row"},n.createElement(v.EmbeddedEntryInlineIcon,{variant:"secondary",className:"rich-text__embedded-entry-list-icon "+an.icon}),n.createElement("span",null,"Inline entry")))},t}(t.Component);ln.propTypes=J,ln.defaultProps={isButton:!1};var cn=I.entityHelpers.getEntryTitle,un=I.entityHelpers.getEntryStatus,dn={scheduledIcon:m.css({verticalAlign:"text-bottom",marginRight:E.spacing2Xs})},pn=function(e){var t=p.useEntities(),r=t.getOrLoadEntry,i=t.loadEntityScheduledActions,o=t.entries;n.useEffect((function(){r(e.entryId)}),[e.entryId]);var s=o[e.entryId];if(n.useEffect((function(){s&&e.onEntityFetchComplete&&e.onEntityFetchComplete()}),[s]),"failed"===s)return n.createElement(y.InlineEntryCard,{testId:u.INLINES.EMBEDDED_ENTRY,isSelected:e.isSelected},n.createElement(y.Text,null,"Entry missing or inaccessible"));if(void 0===s)return n.createElement(y.InlineEntryCard,{isLoading:!0});var a=e.sdk.space.getCachedContentTypes().find((function(e){return e.sys.id===s.sys.contentType.sys.id})),l=a?a.name:"",c=un(s.sys);if("deleted"===c)return n.createElement(y.InlineEntryCard,{testId:u.INLINES.EMBEDDED_ENTRY,isSelected:e.isSelected,actions:[n.createElement(y.MenuItem,{key:"remove",onClick:e.onRemove},"Remove")]},n.createElement(y.Text,null,"Entry missing or inaccessible"));var d=cn({entry:s,contentType:a,localeCode:e.sdk.field.locale,defaultLocaleCode:e.sdk.locales.default,defaultTitle:"Untitled"});return n.createElement(y.InlineEntryCard,{testId:u.INLINES.EMBEDDED_ENTRY,isSelected:e.isSelected,title:l+": "+d,status:c,actions:e.isReadOnly?void 0:[n.createElement(y.MenuItem,{key:"edit",onClick:e.onEdit},"Edit"),n.createElement(y.MenuItem,{key:"edit",onClick:e.onRemove,isDisabled:e.isDisabled},"Remove")]},n.createElement(p.ScheduledIconWithTooltip,{getEntityScheduledActions:i,entityType:"Entry",entityId:s.sys.id},n.createElement(v.ClockIcon,{className:dn.scheduledIcon,variant:"muted",testId:"scheduled-icon"})),n.createElement(y.Text,null,d))};pn.propTypes={sdk:r.object.isRequired,entryId:r.string.isRequired,isDisabled:r.bool.isRequired,isSelected:r.bool.isRequired,isReadOnly:r.bool.isRequired,onRemove:r.func.isRequired,onEdit:r.func.isRequired,onEntityFetchComplete:r.func};var fn=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).handleEditClick=function(){var e=t.getEntitySys();return t.props.sdk.navigator.openEntry(e.id,{slideIn:!0})},t.handleRemoveClick=function(){var e=t.props;e.editor.removeNodeByKey(e.node.key)},t}H(t,e);var r=t.prototype;return r.getEntitySys=function(){var e=this.props.node.data;return{id:e.get("target").sys.id,type:e.get("target").sys.linkType}},r.render=function(){var e=this.props,t=e.sdk,r=e.editor,i=e.isSelected,o=r.props.readOnly,s=r.props.actionsDisabled,a=this.getEntitySys().id;return n.createElement("span",Object.assign({},this.props.attributes,{className:an.root}),n.createElement(pn,{sdk:t,entryId:a,isSelected:i,isDisabled:o,isReadOnly:s,onRemove:this.handleRemoveClick,onEdit:this.handleEditClick,onEntityFetchComplete:this.props.onEntityFetchComplete}))},t}(n.Component);fn.propTypes={sdk:r.object.isRequired,isSelected:r.bool.isRequired,attributes:r.object.isRequired,editor:r.object.isRequired,node:r.object.isRequired,onEntityFetchComplete:r.func.isRequired};var hn,mn,yn=function(e){var t=e.richTextAPI,r=t.sdk,i=t.logShortcutAction,o=t.logViewportAction;return{renderNode:function(e,t,i){var s=e.key;return e.node.type===u.INLINES.EMBEDDED_ENTRY?n.createElement(fn,Object.assign({sdk:r},e,e.attributes,{onEntityFetchComplete:function(){o("linkRendered",{key:s})}})):i()},onKeyDown:function(e,t,n){if(!g(["mod+shift+2"],e)||!sn(t))return g("enter",e)&&function(e){var t=e.value.inlines,n=e.value.selection;if(1===t.size&&n.start.key===n.end.key)return t.get(0).type===u.INLINES.EMBEDDED_ENTRY}(t)?(e.preventDefault(),void t.moveToStartOfNextText()):n();on(r,t,i)}}},En=function(e,t,n){var r=Y(),i=r.utils,o=r.changes,s=o.unwrapList,a=o.wrapInList;if(i.isSelectionInList(e.value))if(i.getCurrentList(e.value).type!==t){var l=i.getCurrentList(e.value);e.setNodeByKey(l.key,t),n("insert",{nodeType:t})}else s(e),n("remove",{nodeType:t});else a(e,t),n("insert",{nodeType:t});return e.focus()},gn=function(e,t){var n=Y().utils.getCurrentList(e.value);return!!n&&n.type===t},vn=function(e){var n=e.type,r=e.title,i=e.children;return function(e){var o,s;return s=o=function(o){function s(){for(var e,t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=o.call.apply(o,[this].concat(r))||this).handleToggle=le(q(e),(function(){var t=e.props,r=t.editor,i=t.onToggle;En(r,n,t.richTextAPI.logToolbarAction),i(r)})),e}return H(s,o),s.prototype.render=function(){return t.createElement(e,{type:n,title:r,onToggle:this.handleToggle,isActive:gn(this.props.editor,n),disabled:this.props.disabled},i)},s}(t.Component),o.propTypes=J,s}},bn=vn({type:u.BLOCKS.UL_LIST,title:"UL",children:n.createElement(v.ListBulletedIcon,null)})((function(e){return n.createElement(Z,e)})),Sn=vn({type:u.BLOCKS.OL_LIST,title:"OL",children:n.createElement(v.ListNumberedIcon,null)})((function(e){return n.createElement(Z,e)})),Tn={hr:m.css(hn||(hn=j(["\n    height: ",";\n    background: transparent;\n    position: relative;\n    margin: 0 0 ",";\n    &:hover {\n      cursor: pointer;\n    }\n    &::after {\n      content: '';\n      position: absolute;\n      width: 100%;\n      height: 1px;\n      background: ",";\n      top: 50%;\n    }\n  "])),E.spacingM,E.spacingL,E.gray300),hrSelected:m.css(mn||(mn=j(["\n    &::after {\n      background: ",";\n      -webkit-box-shadow: 0px 0px 5px ",";\n      box-shadow: 0px 0px 5px ",";\n    }\n  "])),E.colorPrimary,E.colorPrimary,E.colorPrimary)},Cn=function(e){function t(){return e.apply(this,arguments)||this}return H(t,e),t.prototype.render=function(){return n.createElement(Z,this.props)},t}(t.Component),kn=xt({type:u.BLOCKS.HR,title:"HR",children:n.createElement(v.HorizontalRuleIcon,null),applyChange:function(e,t){var n={type:t,object:"block"};0===e.value.blocks.size||oe(e)?e.insertBlock(n):e.setBlocks(n),e.insertBlock(u.BLOCKS.PARAGRAPH).focus()}})(Cn),In=function(e){var t=d.toContentfulDocument({document:e.value.document.toJSON(),schema:V});return L.documentToPlainTextString(t).length},An=function(e){var t=e.richTextAPI.logShortcutAction;return{onPaste:function(e,n,r){var i=global.getSelection().toString().length,o=In(n);setTimeout((function(){var e=In(n);t("paste",{characterCountAfter:e,characterCountBefore:o,characterCountSelection:i})})),r()}}},Ln={p:u.BLOCKS.PARAGRAPH,ul:u.BLOCKS.UL_LIST,ol:u.BLOCKS.OL_LIST,blockquote:u.BLOCKS.QUOTE,hr:u.BLOCKS.HR,h1:u.BLOCKS.HEADING_1,h2:u.BLOCKS.HEADING_2,h3:u.BLOCKS.HEADING_3,h4:u.BLOCKS.HEADING_4,h5:u.BLOCKS.HEADING_5,h6:u.BLOCKS.HEADING_6},xn={strong:u.MARKS.BOLD,b:u.MARKS.BOLD,em:u.MARKS.ITALIC,i:u.MARKS.ITALIC,u:u.MARKS.UNDERLINE,code:u.MARKS.CODE},Nn=[{deserialize:function(e,t){if(e.ownerDocument.querySelector("[id*=docs-internal-guid-]")){if(function(e){return"b"===e.tagName.toLowerCase()&&e.id.startsWith("docs-internal-guid-")}(e))return t(e.childNodes);if("span"===e.tagName.toLowerCase()){var n=[];return function(e){return"700"===e.style.fontWeight}(e)&&n.push(u.MARKS.BOLD),function(e){return"italic"===e.style.fontStyle}(e)&&n.push(u.MARKS.ITALIC),function(e){return"underline"===e.style.textDecoration}(e)&&n.push(u.MARKS.UNDERLINE),{object:"text",leaves:[{object:"leaf",text:e.textContent,marks:n.map((function(e){return{object:"mark",type:e}}))}]}}}}},{deserialize:function(e,t){if("li"===e.tagName.toLowerCase()){var n=t(e.childNodes);return n=n.map((function(e){return"text"===e.object?{object:"block",type:u.BLOCKS.PARAGRAPH,nodes:[e]}:e})),{object:"block",type:u.BLOCKS.LIST_ITEM,nodes:n}}}},{deserialize:function(e,t){if("a"===e.tagName.toLowerCase())return e.getAttribute("href")?{object:"inline",type:u.INLINES.HYPERLINK,nodes:t(e.childNodes),data:{uri:e.getAttribute("href")}}:t(e.childNodes)}},{deserialize:function(e){if("br"===e.tagName.toLowerCase()&&e.classList.contains("Apple-interchange-newline"))return null}},{deserialize:function(e,t){var n=xn[e.tagName.toLowerCase()];if(n)return{object:"mark",type:n,nodes:t(e.childNodes)}}},{deserialize:function(e,t){var n=Ln[e.tagName.toLowerCase()];if(n){var r=t(e.childNodes);return{object:"block",type:n,nodes:r.length>0?r:[{object:"text"}]}}}}],Dn=function(e){if(!e.value.startText)return null;var t=e.value.startText.text.slice(0,e.value.selection.start.offset),n=/\/(\S*)$/.exec(t);return null===n?null:n[1]||n[0]},On=function(e,t,n){void 0===n&&(n=1),e.removeTextByKey(e.value.selection.start.key,e.value.selection.start.offset-(t.length+n),t.length+n)};function wn(e,t){return Rn.apply(this,arguments)}function Rn(){return(Rn=K(Re.mark((function e(t,n){return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n=""),e.next=3,t.space.getAssets({query:n});case 3:return e.abrupt("return",e.sent.items.map((function(e){return{contentTypeName:"Asset",displayTitle:e.fields.title?e.fields.title[t.field.locale]:"Untitled",id:e.sys.id,entry:e,thumbnail:e.fields.file&&e.fields.file[t.field.locale]&&e.fields.file[t.field.locale].url+"?h=30"}})));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Bn(e,t,n){return Pn.apply(this,arguments)}function Pn(){return(Pn=K(Re.mark((function e(t,n,r){return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r=""),e.next=3,t.space.getEntries({content_type:n.sys.id,query:r});case 3:return e.abrupt("return",Promise.all(e.sent.items.map(function(){var e=K(Re.mark((function e(r){var i,o;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=I.entityHelpers.getEntityDescription({contentType:n,entity:r,localeCode:t.field.locale,defaultLocaleCode:t.locales.default}),o=I.entityHelpers.getEntryTitle({entry:r,contentType:n,localeCode:t.field.locale,defaultLocaleCode:t.locales.default,defaultTitle:"Untitled"}),e.abrupt("return",{contentTypeName:n.name,displayTitle:o,id:r.sys.contentType.sys.id,description:i,entry:r});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Kn=function(e,t,n){if(0===e.validations.length)return!0;var r=e.validations.filter((function(e){return e.nodes}))[0].nodes;return void 0===r[n]||!!r[n].filter((function(e){return e.linkContentType})).reduce((function(e,t){return[].concat(e,[t.linkContentType])}),[]).reduce((function(e,t){return[].concat(e,t)}),[]).find((function(e){return e===t.sys.id}))},_n=function(){function e(e){this.sdk=e}var t=e.prototype;return t.maybeBuildEmbedAction=function(e,t,n){return!!Ge(this.sdk.field,e)&&!(t&&!Kn(this.sdk.field,t,e))&&Hn(e,t,"embed",n)},t.maybeBuildCreateAndEmbedAction=function(){var e=K(Re.mark((function e(t,n,r){return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ge(this.sdk.field,t)){e.next=2;break}return e.abrupt("return",!1);case 2:if(!n){e.next=13;break}if(Kn(this.sdk.field,n,t)){e.next=6;break}return e.abrupt("return",!1);case 6:return e.next=8,this.sdk.access.can("create",{sys:{type:"Entry",contentType:{sys:n.sys}}});case 8:if(!1!==e.sent){e.next=11;break}return e.abrupt("return",!1);case 11:e.next=18;break;case 13:return e.next=15,this.sdk.access.can("create","Asset");case 15:if(!1!==e.sent){e.next=18;break}return e.abrupt("return",!1);case 18:return e.abrupt("return",Hn(t,n,"create_embed",r));case 19:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),e}();function Hn(e,t,n,r){var i=!t,o=e===u.INLINES.EMBEDDED_ENTRY;return{label:("embed"===n?"Embed":"Create and embed")+" "+(i?"Asset":t.name)+" "+(o?" - Inline":""),group:i?"Assets":t.name,callback:r,icon:o?"EmbeddedEntryInline":"EmbeddedEntryBlock"}}var Mn={commandPanel:m.css({display:"block",background:E.colorWhite,boxShadow:"0 2px 5px rgba(0, 0, 0, 0.1), 0 5px 10px -5px rgba(0, 0, 0, 0.3)",border:"1px solid "+E.gray400,borderRadius:E.borderRadiusMedium,fontFamily:E.fontStackPrimary,width:"500px",overflowY:"auto"}),commandPanelList:m.css({display:"block",listStyle:"none",margin:0,padding:0,height:"200px",overflowY:"auto"}),item:m.css({fontSize:E.fontSizeM,lineHeight:E.lineHeightDefault,padding:E.spacingS+" "+E.spacingXs,borderBottom:"1px solid "+E.gray300,margin:0,color:E.gray900}),divider:m.css({fontWeight:E.fontWeightDemiBold,padding:E.spacingS+" "+E.spacingXs,letterSpacing:E.letterSpacingWide,fontSize:E.fontSizeS,textTransform:"uppercase",borderBottom:"1px solid "+E.gray400,margin:0,lineHeight:E.lineHeightDefault,color:E.gray900}),icon:m.css({marginRight:10}),isSelected:m.css({background:E.gray200}),skeletonContainer:m.css({padding:E.spacingM,height:200,margin:0}),button:m.css({textAlign:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",width:"100%",display:"flex",alignItems:"center",border:"none",background:"transparent",fontSize:E.fontSizeM}),navBar:m.css({display:"flex",bottom:0,background:E.gray100,padding:E.spacingS+" "+E.spacingXs,width:"100%"}),loader:m.css({marginLeft:"auto"}),thumbnail:m.css({marginRight:15}),instruction:m.css({marginRight:15,color:E.gray600}),closeButton:m.css({marginLeft:"auto"})},qn=r.shape({label:r.string,icon:r.string,thumbnail:r.string,callback:r.func}),jn=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).listItemRef=null,t}H(t,e);var r=t.prototype;return r.componentDidUpdate=function(){this.props.isSelected&&this.listItemRef.scrollIntoView({block:"nearest",inline:"start"})},r.render=function(){var e=this,t=this.props,r=t.item;return n.createElement("li",{key:t.index,className:t.classNames,ref:function(t){e.listItemRef=t}},n.createElement("button",{type:"button",className:Mn.button,onClick:r.callback&&r.callback},r.icon&&n.createElement(y.Icon,{className:Mn.icon,as:r.icon,variant:"secondary"}),r.thumbnail&&n.createElement("img",{className:Mn.thumbnail,src:r.thumbnail,alt:""}),r.label))},t}(n.Component);jn.propTypes={isSelected:r.bool,index:r.number,classNames:r.string,item:qn};var Un=function(e){return n.createElement("span",{className:Mn.instruction},e.children)};Un.propTypes={children:r.node};var Fn=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).state={selectedKey:0,items:[]},t.handleKeyboard=function(e){if(g("up",e)){if(0===t.state.selectedKey)return;t.setState((function(e){return{selectedKey:e.selectedKey-1}}))}if(g("down",e)){if(t.state.selectedKey===t.state.items.length-1)return;t.setState((function(e){return{selectedKey:e.selectedKey+1}}))}if(g("enter",e)){var n=t.state.items[t.state.selectedKey];n&&n.callback&&n.callback()}},t.renderNavigationBar=function(){return n.createElement("div",{className:Mn.navBar},n.createElement(y.SectionHeading,{marginBottom:"none"},t.props.breadcrumb?"Embed "+t.props.breadcrumb:"Richtext Commands"),n.createElement(y.IconButton,{"aria-label":"Close",className:Mn.closeButton,icon:n.createElement(v.CloseIcon,{variant:"muted"}),variant:"transparent",onClick:t.props.onClose}))},t.renderStatusBar=function(){return n.createElement("div",{className:Mn.navBar},n.createElement("span",{className:Mn.instructions},n.createElement(Un,null,"↑ ↓ to navigate"),n.createElement(Un,null,"↵ to confirm"),n.createElement(Un,null,"esc to close")),t.props.isUpdating&&n.createElement("span",{className:Mn.loader},"loading ",n.createElement(y.Spinner,{size:"small"})))},t.renderSkeleton=function(){return n.createElement("li",{className:Mn.skeletonContainer},n.createElement(y.SkeletonContainer,null,n.createElement(y.SkeletonBodyText,{numberOfLines:7})))},t}H(t,e),t.getDerivedStateFromProps=function(e,t){var n=e.items!==t.originalItems,r=e.searchString!==t.originalSearchString,i=e.items.filter((function(t){return t.label.toLowerCase().includes(e.searchString?e.searchString.toLowerCase():"")}));return{originalItems:e.items,originalSearchString:e.searchString,items:i,selectedKey:n||r?0:t.selectedKey}};var r=t.prototype;return r.componentDidMount=function(){this.props.richTextAPI.logViewportAction("openRichTextCommandsPalette"),document.addEventListener("keydown",this.handleKeyboard,!0)},r.componentWillUnmount=function(){this.props.richTextAPI.logViewportAction("cancelRichTextCommandsPalette"),document.removeEventListener("keydown",this.handleKeyboard,!0)},r.renderGroups=function(){var e=this,t=B(this.state.items.map((function(e){return e.group})),(function(e){return e}));return t.length?t.map((function(t,r){return n.createElement(n.Fragment,{key:r},t&&n.createElement("li",{key:t,className:Mn.divider},t),e.renderItems(t))})):n.createElement("li",{className:Mn.item},"No results")},r.renderItems=function(e){var t=this;return this.state.items.filter((function(t){return t.group===e})).map((function(e){var r,i=t.state.items.indexOf(e),o=i===t.state.selectedKey,s=R(Mn.item,((r={})[Mn.isSelected]=o,r));return n.createElement(jn,{item:e,classNames:s,key:i,isSelected:o})}))},r.render=function(){var e=this.props,t=e.testId,r=e.isLoading,i=R(Mn.commandPanel,e.className);return n.createElement("div",{className:i},this.renderNavigationBar(),n.createElement("ul",{className:Mn.commandPanelList,"data-test-id":t},r?this.renderSkeleton():this.renderGroups()),this.renderStatusBar())},t}(n.Component);Fn.propTypes={items:r.arrayOf(qn),searchString:r.string,className:r.string,testId:r.string,isLoading:r.bool,isUpdating:r.bool,breadcrumb:r.string,richTextAPI:r.object,onClose:r.func},Fn.defaultProps={className:void 0,searchString:"",items:[],testId:"cf-ui-command-panel",isLoading:!0,isUpdating:!1};var Gn=["className","children","testId","onOverflowBottom","onOverflowLeft","onOverflowRight","onOverflowTop"],Yn=function(e,t){void 0===e&&(e=200);var n=0;return function(){var r=(new Date).getTime();if(!(r-n<e))return n=r,t.apply(void 0,arguments)}},zn="undefined"!=typeof window,Wn=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).tGetDomPosition=null,t.nodeRef=null,t.lastOverflowAt=null,t.tOnOverflowTop=t.props.onOverflowTop&&Yn(100,t.props.onOverflowTop),t.tOnOverflowBottom=t.props.onOverflowBottom&&Yn(100,t.props.onOverflowBottom),t.tOnOverflowRight=t.props.onOverflowRight&&Yn(100,t.props.onOverflowRight),t.tOnOverflowLeft=t.props.onOverflowLeft&&Yn(100,t.props.onOverflowLeft),t.getDomPosition=function(){if(zn&&t.nodeRef){var e=document.documentElement,n=t.nodeRef.getBoundingClientRect(),r=window.innerWidth||e.clientWidth,i=window.innerHeight||e.clientHeight;t.handleOverflow(n,r,i)}},t.bindEventListeners=function(){t.tGetDomPosition=Yn(600,t.getDomPosition),zn&&t.tGetDomPosition&&(window.addEventListener("scroll",t.tGetDomPosition,!0),window.addEventListener("resize",t.tGetDomPosition))},t.handleOverflow=function(e,n,r){var i=e.top,o=e.left,s=e.bottom,a=e.right,l=t.props.offset,c=0-l,u=n+l,d=r+l;i+a+s+o!==0&&(i<0-l&&"bottom"!==t.lastOverflowAt?(t.lastOverflowAt="top",t.tOnOverflowTop&&t.tOnOverflowTop()):o<c&&"right"!==t.lastOverflowAt?(t.lastOverflowAt="left",t.tOnOverflowLeft&&t.tOnOverflowLeft()):s>d&&"top"!==t.lastOverflowAt?(t.lastOverflowAt="bottom",t.tOnOverflowBottom&&t.tOnOverflowBottom()):a>u&&"left"!==t.lastOverflowAt&&(t.lastOverflowAt="right",t.tOnOverflowRight&&t.tOnOverflowRight()))},t}H(t,e);var r=t.prototype;return r.componentDidMount=function(){this.getDomPosition(),this.bindEventListeners()},r.componentDidUpdate=function(){this.getDomPosition()},r.componentWillUnmount=function(){zn&&this.tGetDomPosition&&(window.removeEventListener("scroll",this.tGetDomPosition,!0),window.removeEventListener("resize",this.tGetDomPosition))},r.render=function(){var e=this,t=this.props,r=t.className,i=t.children,o=t.testId,s=M(t,Gn),a=m.cx(m.css({display:"inline-block"}),r);return n.createElement("div",Object.assign({ref:function(t){e.nodeRef=t},className:a,"data-test-id":o},s),i)},t}(t.Component);Wn.defaultProps={testId:"cf-ui-in-viewport",offset:0},Wn.propTypes={offset:r.number,onOverflowTop:r.func,onOverflowRight:r.func,onOverflowBottom:r.func,onOverflowLeft:r.func,className:r.string,children:r.any,testId:r.string};var Vn={top:0,left:0},Qn=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).state={anchorPosition:Vn,items:[],isLoading:!0,panelPosition:"bottom"},t.paletteDimensions={height:300,width:300},t.bindEventListeners=function(){document.addEventListener("scroll",t.handleScroll,!0),document.addEventListener("keydown",t.handleKeyboard,!0),document.addEventListener("click",t.handleOutsideClick,!0)},t.removeEventListeners=function(){document.removeEventListener("scroll",t.handleScroll,!0),document.removeEventListener("keydown",t.handleKeyboard,!0),document.removeEventListener("click",t.handleOutsideClick,!0)},t.handleOutsideClick=function(e){t.palette.contains(e.target)||t.setState({isClosed:!0})},t.requestUpdate=O((function(){t.state.currentCommand&&(t.setState({isUpdating:!0}),t.createCommands(t.state.currentCommand.contentType,t.state.currentCommand.type,t.props.command))}),1e3,{leading:!0,trailing:!1}),t.createCommand=function(e,n,r,i,o,s){return{label:e+(o?" - "+o:""),thumbnail:s,contentType:n,callback:function(){var e=t.props,n=e.editor,o=e.richTextAPI.logCommandPaletteAction;switch(On(n,e.command),i){case u.INLINES.EMBEDDED_ENTRY:rn(n,r.sys.id,!1),o("insert",{nodeType:u.INLINES.EMBEDDED_ENTRY});break;case u.BLOCKS.EMBEDDED_ASSET:Xt(n,u.BLOCKS.EMBEDDED_ASSET,r,!1),o("insert",{nodeType:u.BLOCKS.EMBEDDED_ASSET});break;default:Xt(n,u.BLOCKS.EMBEDDED_ENTRY,r,!1),o("insert",{nodeType:u.BLOCKS.EMBEDDED_ENTRY})}}}},t.onCreateAndEmbedEntity=function(){var e=K(Re.mark((function e(n,r){var i,o,s,a,l,c,d,p,f,h,m,y,E,g;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(o=(i=t.props).richTextAPI).sdk,On(s=i.editor,i.command),c=(l=a.space).createAsset,d=l.createEntry,p=null===n,f=function(){return p?c({}):d(n,{})},e.next=8,f();case 8:return y=(m=(h=e.sent).sys).id,E=m.type,r===u.INLINES.EMBEDDED_ENTRY?rn(s,h.sys.id,!1):Xt(s,r,h),o.logCommandPaletteAction("insert",{nodeType:r}),g=a.navigator,e.abrupt("return",("Asset"===E?g.openAsset:g.openEntry)(y,{slideIn:!0}));case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),t.createContentTypeActions=function(){var e=K(Re.mark((function e(n,r){return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.maybeBuildEmbedAction(u.BLOCKS.EMBEDDED_ENTRY,r,(function(){t.setState({breadcrumb:r.name,isLoading:!0}),t.createCommands(r),t.clearCommand()})),n.maybeBuildEmbedAction(u.INLINES.EMBEDDED_ENTRY,r,(function(){t.setState({breadcrumb:r.name,isLoading:!0}),t.createCommands(r,u.INLINES.EMBEDDED_ENTRY),t.clearCommand()})),n.maybeBuildCreateAndEmbedAction(u.BLOCKS.EMBEDDED_ENTRY,r,(function(){return t.onCreateAndEmbedEntity(r.sys.id,u.BLOCKS.EMBEDDED_ENTRY)})),n.maybeBuildCreateAndEmbedAction(u.INLINES.EMBEDDED_ENTRY,r,(function(){return t.onCreateAndEmbedEntity(r.sys.id,u.INLINES.EMBEDDED_ENTRY)}))]);case 2:return e.abrupt("return",e.sent.filter((function(e){return e})));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),t.createAssetActions=function(){var e=K(Re.mark((function e(n){return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.maybeBuildEmbedAction(u.BLOCKS.EMBEDDED_ASSET,null,(function(){t.setState({breadcrumb:"Asset",isLoading:!0}),t.createCommands(null,u.BLOCKS.EMBEDDED_ASSET),t.clearCommand()})),n.maybeBuildCreateAndEmbedAction(u.BLOCKS.EMBEDDED_ASSET,null,(function(){return t.onCreateAndEmbedEntity(null,u.BLOCKS.EMBEDDED_ASSET)}))]);case 2:return e.abrupt("return",e.sent.filter((function(e){return e})));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.handleScroll=function(e){"UL"!==e.target.nodeName&&t.updatePanelPosition()},t.clearCommand=function(){"/"!==t.props.command&&On(t.props.editor,t.props.command,0)},t.createCommands=function(){var e=K(Re.mark((function e(n,r,i){var o;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.setState({isUpdating:!0}),n){e.next=7;break}return e.next=4,wn(t.props.richTextAPI.sdk,i);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,Bn(t.props.richTextAPI.sdk,n,i);case 9:e.t0=e.sent;case 10:o=e.t0,t.isComponentMounted&&t.setState({currentCommand:{contentType:n,type:r,command:i},isUpdating:!1,isLoading:!1,items:o.map((function(e){return t.createCommand(e.displayTitle,e.contentTypeName,e.entry,r,e.description,e.thumbnail)}))});case 12:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),t.createInitialCommands=K(Re.mark((function e(){var n,r,i,o,s;return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=t.props.richTextAPI.sdk).space.getCachedContentTypes(),t.setState({isLoading:!1}),i=new _n(n),e.t0=w,e.next=7,Promise.all(r.map((function(e){return t.createContentTypeActions(i,e)})));case 7:return e.t1=e.sent,o=(0,e.t0)(e.t1),e.next=11,t.createAssetActions(i);case 11:s=e.sent,t.setState((function(e){return{items:[].concat(e.items,o,s)}}));case 13:case"end":return e.stop()}}),e)}))),t.handleKeyboard=function(e){var n=g("esc",e);(n||g("down",e)||g("up",e)||g("enter",e))&&(e.preventDefault(),e.stopPropagation()),(n||g("tab",e))&&t.setState({isClosed:!0})},t}H(t,e);var r=t.prototype;return r.componentDidMount=function(){var e=K(Re.mark((function e(){return Re.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isComponentMounted=!0,e.next=3,this.createInitialCommands();case 3:this.updatePanelPosition(),this.paletteDimensions={height:this.palette.getBoundingClientRect().height,width:this.palette.getBoundingClientRect().width};case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.componentWillUnmount=function(){this.isComponentMounted=!1,this.removeEventListeners(),this.requestUpdate.cancel()},r.componentDidUpdate=function(){this.state.currentCommand&&this.state.currentCommand.command!==this.props.command?this.requestUpdate():this.requestUpdate.cancel(),this.state.isClosed?this.removeEventListeners():this.bindEventListeners()},r.render=function(){var e=this;if(this.state.isClosed)return null;var t=window.document.body;return D.createPortal(n.createElement("div",{tabIndex:"1",ref:function(t){e.palette=t},style:{position:"absolute",outline:"none",minWidth:200,top:this.state.anchorPosition.top,left:this.state.anchorPosition.left,zIndex:E.zIndexDropdown}},n.createElement(Wn,{onOverflowBottom:function(){"top"!==e.state.panelPosition&&e.setState({panelPosition:"top"},e.updatePanelPosition)},onOverflowTop:function(){"bottom"!==e.state.panelPosition&&e.setState({panelPosition:"bottom"},e.updatePanelPosition)}},n.createElement(Fn,{searchString:"/"===this.props.command?"":this.props.command,items:this.state.items,isLoading:this.state.isLoading,isUpdating:this.state.isUpdating,onClose:function(){e.setState({isClosed:!0})},breadcrumb:this.state.breadcrumb,richTextAPI:this.props.richTextAPI}))),t)},r.updatePanelPosition=function(){var e=this,t=document.getSelection().getRangeAt(0).getBoundingClientRect();this.setState((function(n){return{anchorPosition:{top:"bottom"===n.panelPosition?t.bottom:t.top-e.paletteDimensions.height,left:t.left}}}))},t}(n.PureComponent);Qn.propTypes={editor:r.object,command:r.string,richTextAPI:r.object};var Xn=function(e){function t(t){var n,r;return(n=e.call(this,t)||this).state={embedsEnabled:(r=n.props.richTextAPI.sdk.field,Ge(r,u.BLOCKS.EMBEDDED_ASSET)||Ge(r,u.BLOCKS.EMBEDDED_ENTRY)||Ge(r,u.INLINES.EMBEDDED_ENTRY))},n}return H(t,e),t.prototype.render=function(){return function(e){var t=e.value.document.getDecorations(e);if(t.isEmpty())return!1;var n=t.find((function(e){return"richTextCommandsContext"===e.mark.type}));return Boolean(n)}(this.props.editor)&&this.state.embedsEnabled?n.createElement(Qn,{editor:this.props.editor,richTextAPI:this.props.richTextAPI,command:Dn(this.props.editor)}):null},t}(n.PureComponent);Xn.propTypes={editor:r.object,richTextAPI:r.object};var Jn=function(e){function t(){return e.apply(this,arguments)||this}return H(t,e),t.prototype.render=function(){var e=this.props,t=e.children;return n.createElement("span",Object.assign({tabIndex:"1"},e.attributes,{className:"command-context"}),t)},t}(n.PureComponent);Jn.propTypes={children:r.node.isRequired,editor:r.object,attributes:r.object};var $n=function(e){var t=e.richTextAPI;return{decorateNode:function(e,t,n){var r=n(),i=function(e){var t=e.value;if(!t.startText)return null;var n=Dn(e),r=t.selection;return n?{anchor:{key:r.start.key,offset:r.start.offset-(n.length+1)},focus:{key:r.start.key,offset:r.start.offset},mark:{type:"richTextCommandsContext"}}:null}(t);return i?[].concat(r,[i]):[].concat(r)},renderMark:function(e,t,r){return"richTextCommandsContext"===e.mark.type?n.createElement(Jn,{attributes:e.attributes,editor:t},e.children):r()},renderEditor:function(e,r,i){var o=i();return n.createElement(n.Fragment,null,o,n.createElement(Xn,{anchor:r.state.commandMark,value:r.value,editor:r,richTextAPI:t}))}}};function Zn(e){return[{schema:V},{onKeyDown:function(e,t,n){if(!g("enter",e)||!function(e){return e.value.document.getBlocks().first()===e.value.focusBlock&&e.isVoid(e.value.focusBlock)}(t))return n();!function(e){e.splitBlock().moveToStartOfDocument().setBlocks(u.BLOCKS.PARAGRAPH).focus()}(t)}},(a={richTextAPI:e},ae({type:u.MARKS.BOLD,tagName:"b",hotkey:["mod+b"],richTextAPI:a.richTextAPI})),pe({richTextAPI:e}),me({richTextAPI:e}),ge({richTextAPI:e}),Ne({richTextAPI:e}),St({richTextAPI:e}),Kt({richTextAPI:e}),_t({richTextAPI:e}),Ht({richTextAPI:e}),Mt({richTextAPI:e}),qt({richTextAPI:e}),jt({richTextAPI:e}),(void 0===r&&(r=u.BLOCKS.PARAGRAPH),function(e,t,n,r){return{renderNode:function(t,r,i){return t.node.type===e?xe("div",n)(t):i()},onKeyDown:function(t,n,i){if(!g(r,t))return i();n.call(Se,e)}}}(r,0,{},["mod+opt+0"])),{renderNode:function(e,t,r){return e.node.type===u.BLOCKS.HR?n.createElement("hr",Object.assign({className:m.cx(Tn.hr,e.isSelected&&Tn.hrSelected)},e.attributes)):r()}},yn({richTextAPI:e}),(s={richTextAPI:e},tn({richTextAPI:s.richTextAPI,nodeType:u.BLOCKS.EMBEDDED_ENTRY,hotkey:["mod+shift+e"]})),(o={richTextAPI:e},tn({richTextAPI:o.richTextAPI,nodeType:u.BLOCKS.EMBEDDED_ASSET,hotkey:["mod+shift+a"]})),_({},Y(),{renderNode:function(e,t,n){return e.node.type===u.BLOCKS.UL_LIST?xe("ul")(e):e.node.type===u.BLOCKS.OL_LIST?xe("ol")(e):e.node.type===u.BLOCKS.LIST_ITEM?xe("li")(e):n()}}),An({richTextAPI:e}),(t=new x({rules:Nn}),{onPaste:function(e,n,r){var o=i.getEventTransfer(e);if("html"==o.type){var s=t.deserialize(o.html);n.insertFragment(s.document)}else r()}}),{onPaste:function(e,t,n){var r=i.getEventTransfer(e);if("text"===r.type){var o=N.deserialize(r.text,{defaultBlock:u.BLOCKS.PARAGRAPH,delimiter:"\n\n"});t.insertFragment(o.document)}else n()}},$n({richTextAPI:e}),A({type:u.BLOCKS.PARAGRAPH}),{onKeyDown:function(e,t,n){if(!g("shift+enter",e))return n();t.insertText("\n")}}];var t,r,o,s,a}var er=function(e){function t(){return e.apply(this,arguments)||this}return H(t,e),t.prototype.render=function(){var e=this.props,t=e.children;return n.createElement(y.Menu,{placement:"bottom-end",isOpen:e.isOpen,onClose:e.onClose,onOpen:e.onOpen},n.createElement(y.Menu.Trigger,null,n.createElement(y.Button,{endIcon:n.createElement(v.ChevronDownIcon,null),testId:"toolbar-entry-dropdown-toggle",className:"toolbar-entry-dropdown-toggle",variant:"secondary",size:"small",startIcon:n.createElement(v.PlusIcon,null),isDisabled:this.props.disabled},"Embed")),n.createElement(y.Menu.List,{className:"toolbar-entry-dropdown-list"},t))},t}(t.Component);er.propTypes={children:r.node.isRequired,isOpen:r.bool,disabled:r.bool,onClose:r.func,onOpen:r.func};var tr,nr={toolbar:m.css({border:"1px solid "+E.gray400,backgroundColor:E.gray100,padding:E.spacingXs,borderRadius:E.borderRadiusMedium+" "+E.borderRadiusMedium+" 0 0"}),divider:m.css({display:"inline-block",height:"21px",width:"1px",background:E.gray300,margin:"0 "+E.spacing2Xs}),embedActionsWrapper:m.css({display:["-webkit-box","-ms-flexbox","flex"],webkitAlignSelf:"flex-start",alignSelf:"flex-start",msFlexItemAlign:"start",marginLeft:"auto"}),formattingOptionsWrapper:m.css({display:["-webkit-box","-ms-flexbox","flex"],msFlexAlign:"center",webkitBoxAlign:"center",alignItems:"center",msFlexWrap:"wrap",flexWrap:"wrap",marginRight:"20px"})},rr=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).hasMounted=!1,t.isReadyToSetFocusProgrammatically=!1,t.state=_({headingMenuOpen:!1,canAccessAssets:!1},ir(t.props.richTextAPI.sdk.field)),t.onChange=function(){var e;t.setState({headingMenuOpen:!1}),(e=t.props).onChange.apply(e,arguments)},t.handleEmbedDropdownOpen=function(){return t.setState({isEmbedDropdownOpen:!0})},t.handleEmbedDropdownClose=function(){return t.setState({isEmbedDropdownOpen:!1})},t.renderEmbeds=function(e){var r=t.props.richTextAPI.sdk.field,i=Ge(r,u.INLINES.EMBEDDED_ENTRY),o=Ge(r,u.BLOCKS.EMBEDDED_ENTRY),s=t.state.canAccessAssets&&Ge(r,u.BLOCKS.EMBEDDED_ASSET),a=[i,o,s].filter(Boolean).length;return n.createElement("div",{className:nr.embedActionsWrapper},a>1?n.createElement(er,{onOpen:t.handleEmbedDropdownOpen,isOpen:t.state.isEmbedDropdownOpen,disabled:e.disabled,onClose:t.handleEmbedDropdownClose},o&&n.createElement($t,Object.assign({nodeType:u.BLOCKS.EMBEDDED_ENTRY},e)),i&&n.createElement(ln,e),s&&n.createElement($t,Object.assign({nodeType:u.BLOCKS.EMBEDDED_ASSET},e))):n.createElement(n.Fragment,null,o&&n.createElement($t,Object.assign({nodeType:u.BLOCKS.EMBEDDED_ENTRY,isButton:!0},e)),i&&n.createElement(ln,Object.assign({isButton:!0},e)),s&&n.createElement($t,Object.assign({nodeType:u.BLOCKS.EMBEDDED_ASSET,isButton:!0},e))))},t.openHeadingMenu=function(){return t.setState({headingMenuOpen:!0})},t.closeHeadingMenu=function(){return t.setState({headingMenuOpen:!1})},t}H(t,e);var r=t.prototype;return r.componentDidMount=function(){var e=this;this.hasMounted=!0,this.props.richTextAPI.sdk.access.can("read","Asset").then((function(t){e.hasMounted&&e.setState({canAccessAssets:t})}))},r.componentWillUnmount=function(){this.hasMounted=!1},r.render=function(){var e=this.props,t=e.editor,r=e.isDisabled,i=e.richTextAPI;t.value.selection.isFocused&&(this.isReadyToSetFocusProgrammatically=!0);var o={editor:t,onToggle:this.onChange,disabled:r,richTextAPI:i,canAutoFocus:this.isReadyToSetFocusProgrammatically},s=i.sdk.field,a=this.state,l=a.isAnyHyperlinkEnabled,c=a.isAnyListEnabled,d=a.isAnyMarkEnabled,p=o.editor.value.blocks.getIn([0,"type"]);return n.createElement(y.Flex,{testId:"toolbar",className:nr.toolbar,alignItems:"center"},n.createElement("div",{className:nr.formattingOptionsWrapper},n.createElement(Ot,{onOpen:this.openHeadingMenu,isToggleActive:!0,isOpen:this.state.headingMenuOpen,onClose:this.closeHeadingMenu,currentBlockType:p,disabled:o.disabled},n.createElement(Bt,o),Ge(s,u.BLOCKS.HEADING_1)&&n.createElement(Ut,o),Ge(s,u.BLOCKS.HEADING_2)&&n.createElement(Ft,o),Ge(s,u.BLOCKS.HEADING_3)&&n.createElement(Gt,o),Ge(s,u.BLOCKS.HEADING_4)&&n.createElement(Yt,o),Ge(s,u.BLOCKS.HEADING_5)&&n.createElement(zt,o),Ge(s,u.BLOCKS.HEADING_6)&&n.createElement(Wt,o)),d&&n.createElement("span",{className:nr.divider,"data-test-id":"mark-divider"}),Ye(s,u.MARKS.BOLD)&&n.createElement(de,o),Ye(s,u.MARKS.ITALIC)&&n.createElement(he,o),Ye(s,u.MARKS.UNDERLINE)&&n.createElement(Ee,o),Ye(s,u.MARKS.CODE)&&n.createElement(be,o),l&&n.createElement(n.Fragment,null,n.createElement("span",{className:nr.divider,"data-test-id":"hyperlink-divider"}),n.createElement(dt,o)),c&&n.createElement("span",{className:nr.divider,"data-test-id":"list-divider"}),Ge(s,u.BLOCKS.UL_LIST)&&n.createElement(bn,o),Ge(s,u.BLOCKS.OL_LIST)&&n.createElement(Sn,o),Ge(s,u.BLOCKS.QUOTE)&&n.createElement(Oe,o),Ge(s,u.BLOCKS.HR)&&n.createElement(kn,o)),this.renderEmbeds(o))},t}(n.Component);function ir(e){return{isAnyMarkEnabled:Ye(e,u.MARKS.BOLD)||Ye(e,u.MARKS.ITALIC)||Ye(e,u.MARKS.UNDERLINE)||Ye(e,u.MARKS.CODE),isAnyHyperlinkEnabled:Ge(e,u.INLINES.HYPERLINK)||Ge(e,u.INLINES.ASSET_HYPERLINK)||Ge(e,u.INLINES.ENTRY_HYPERLINK),isAnyListEnabled:Ge(e,u.BLOCKS.UL_LIST)||Ge(e,u.BLOCKS.OL_LIST)||Ge(e,u.BLOCKS.QUOTE)||Ge(e,u.BLOCKS.HR)}}rr.propTypes={richTextAPI:r.object.isRequired,isDisabled:r.bool.isRequired,editor:r.object.isRequired,onChange:r.func.isRequired};var or={nativeSticky:m.css(tr||(tr=j(["\n    position: -webkit-sticky;\n    position: sticky;\n    top: -1px;\n    z-index: 2;\n  "])))},sr=function(e){return n.createElement("div",{className:e.isDisabled?"":or.nativeSticky},e.children)};sr.propTypes={isDisabled:r.bool,children:r.node};var ar=["sdk","isInitiallyDisabled"],lr="1px solid "+E.gray400,cr={root:m.css({position:"relative"}),editor:m.css({borderRadius:"0 0 "+E.borderRadiusMedium+" "+E.borderRadiusMedium,border:lr,borderTop:0,padding:"20px",fontFamily:E.fontStackPrimary,fontSize:E.spacingM,minHeight:"380px",background:E.colorWhite,outline:"none",whiteSpace:"pre-wrap",overflowWrap:"break-word",webkitUserModify:"read-write-plaintext-only",a:{span:{cursor:"not-allowed","&:hover":{cursor:"not-allowed"}}}}),hiddenToolbar:m.css({borderTop:lr}),enabled:m.css({background:E.colorWhite,a:{span:{cursor:"pointer","&:hover":{cursor:"pointer"}}}}),disabled:m.css({background:E.gray100})},ur=function(e){var t=d.toSlatejsDocument({document:e,schema:V}),n=o.Value.fromJSON({document:t,schema:V});return new o.Editor({readOnly:!0,value:n},{normalize:!0}).value},dr=ur(u.EMPTY_DOCUMENT),pr=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).state={lastOperations:l.List(),value:t.props.value&&t.props.value.nodeType===u.BLOCKS.DOCUMENT?ur(t.props.value):dr},t.editor=n.createRef(),t.richTextAPI=X({sdk:t.props.sdk,onAction:t.props.onAction}),t.slatePlugins=Zn(t.richTextAPI),t.onChange=function(e){t.setState({value:e.value,lastOperations:e.operations.filter(fr)})},t.callOnChange=a((function(){var e=d.toContentfulDocument({document:t.state.value.document.toJSON(),schema:V});t.props.onChange(e)}),500),t.handleKeyDown=function(e,t,n){return 27===e.keyCode&&e.currentTarget.blur(),n()},t}H(t,e);var r=t.prototype;return r.shouldComponentUpdate=function(e,t){return this.props.isDisabled!==e.isDisabled||!l.is(this.state.value,t.value)||this.props.value!==e.value},r.componentDidUpdate=function(e){var t=this,n=!this.state.lastOperations.isEmpty();!this.props.isDisabled&&n?this.setState({lastOperations:l.List()},(function(){return t.callOnChange()})):c(e.value,t.props.value)||this.setState({value:ur(this.props.value)})},r.render=function(){var e=m.cx(cr.editor,void 0!==this.props.minHeight?m.css({minHeight:this.props.minHeight}):void 0,this.props.isDisabled?cr.disabled:cr.enabled,this.props.isToolbarHidden&&cr.hiddenToolbar);return n.createElement("div",{className:cr.root,"data-test-id":"rich-text-editor"},!this.props.isToolbarHidden&&n.createElement(sr,{isDisabled:this.props.isDisabled},n.createElement(rr,{editor:this.editor.current||new o.Editor({readOnly:!0}),onChange:this.onChange,isDisabled:this.props.isDisabled,richTextAPI:this.richTextAPI})),n.createElement(i.Editor,{"data-test-id":"editor",value:this.state.value,ref:this.editor,onChange:this.onChange,onKeyDown:this.handleKeyDown,plugins:this.slatePlugins,readOnly:this.props.isDisabled,className:e,actionsDisabled:this.props.actionsDisabled,options:{normalize:!1}}))},t}(n.Component);function fr(e){if("set_value"===e.type){if(e.properties.data)return!1}else if("set_selection"===e.type)return!1;return!0}function hr(e){var t=e.sdk,r=e.isInitiallyDisabled,i=M(e,ar);return n.createElement(p.EntityProvider,{sdk:t},"Example test",n.createElement(I.FieldConnector,{throttle:0,field:t.field,isInitiallyDisabled:r,isEmptyValue:function(e){return!e||c(e,u.EMPTY_DOCUMENT)},isEqualValues:function(e,t){return c(e,t)}},(function(e){var r=e.setValue;return n.createElement(pr,Object.assign({},i,{key:"rich-text-editor-"+e.externalReset,value:e.lastRemoteValue,sdk:t,isDisabled:e.disabled,onChange:function(e){r(e)}}))})))}pr.propTypes={minHeight:r.oneOfType([r.string,r.number]),sdk:r.shape({field:r.shape({id:r.string.isRequired,locale:r.string.isRequired}).isRequired,access:r.shape({can:r.func.isRequired}).isRequired,parameters:r.shape({instance:r.shape({getEntryUrl:r.func,getAssetUrl:r.func}).isRequired})}).isRequired,value:r.object,isDisabled:r.bool,onChange:r.func,onAction:r.func,isToolbarHidden:r.bool,actionsDisabled:r.bool},pr.defaultProps={value:u.EMPTY_DOCUMENT,onChange:s,onAction:s,isDisabled:!1,isToolbarHidden:!1,actionsDisabled:!1},hr.defaultProps={isInitiallyDisabled:!0},exports.ConnectedRichTextEditor=pr,exports.RichTextEditor=hr,exports.openRichTextDialog=function(e){return function(t){return t.parameters&&"rich-text-hyperlink-dialog"===t.parameters.type?I.ModalDialogLauncher.openDialog(t,(function(r){return n.createElement(_e,Object.assign({},t.parameters,{onClose:r.onClose,sdk:e}))})):Promise.reject()}},exports.renderRichTextDialog=function(e){return"rich-text-hyperlink-dialog"===e.parameters.invocation.type?(e.window.startAutoResizer(),n.createElement(_e,Object.assign({},e.parameters.invocation,{onClose:e.close,sdk:e}))):n.createElement("div",null)};
//# sourceMappingURL=field-editor-rich-text.cjs.production.min.js.map
